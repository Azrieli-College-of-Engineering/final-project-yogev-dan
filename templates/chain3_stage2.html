<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <title>Stage 2: Reconnaissance - Server Mapping</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        .story-box {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-left: 4px solid #00bcd4;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 0 10px 10px 0;
        }
        .story-narrator { color: #00bcd4; font-style: italic; }
        .hint-revealer {
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            border: 1px dashed #00bcd4;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        .hint-level {
            display: none;
            padding: 10px;
            margin-top: 10px;
            background: rgba(0, 188, 212, 0.1);
            border-left: 3px solid #00bcd4;
            border-radius: 0 5px 5px 0;
        }
        .hint-level.revealed { display: block; animation: fadeIn 0.3s ease; }
        .answer-reveal {
            display: none;
            padding: 15px;
            margin-top: 10px;
            background: rgba(220, 53, 69, 0.2);
            border: 1px solid #dc3545;
            border-radius: 5px;
        }
        .answer-reveal.revealed { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .hint-btn { margin: 2px; }
        .stage-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .stage-indicator { display: flex; gap: 10px; align-items: center; }
        .stage-dot {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
        }
        .stage-dot.active { background: #00bcd4; color: #000; }
        .stage-dot.completed { background: #28a745; color: #fff; }
        .stage-dot.pending { background: #343a40; color: #6c757d; border: 2px solid #6c757d; }
        .success-banner {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        .terminal-box {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Consolas', 'Monaco', monospace;
        }
        .file-tree {
            font-family: monospace;
            background: #1a1a2e;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #30363d;
        }
        .file-tree-item { padding: 3px 0; }
        .file-tree-item.folder { color: #58a6ff; }
        .file-tree-item.file { color: #8b949e; }
        .file-tree-item.secret { color: #f85149; font-weight: bold; }
        .command-history {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 10px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body data-bs-theme="dark">
<nav class="navbar navbar-expand-lg bg-body-tertiary mb-4">
    <div class="container-fluid">
        <a class="navbar-brand" href="/"><i class="bi bi-shield-lock"></i> Web Security Demo</a>
        <span class="badge text-dark fs-6" style="background: #00bcd4;">
            <i class="bi bi-search"></i> The Server Explorer - Stage 2
        </span>
    </div>
</nav>

<div class="container">
    <!-- Stage Navigation -->
    <div class="stage-nav">
        <a href="/attack_chain_3/stage1" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left"></i> Previous Stage
        </a>
        <div class="stage-indicator">
            <a href="/attack_chain_3/stage1" class="stage-dot completed text-decoration-none">1</a>
            <i class="bi bi-arrow-right text-success"></i>
            <div class="stage-dot active">2</div>
            <i class="bi bi-arrow-right text-muted"></i>
            <a href="/attack_chain_3/stage3" class="stage-dot pending text-decoration-none">3</a>
        </div>
        <a href="/attack_chain_3/stage3" class="btn btn-outline-warning">
            Next Stage <i class="bi bi-arrow-right"></i>
        </a>
    </div>

    <!-- Stage Header -->
    <div class="text-center mb-4">
        <h1><i class="bi bi-2-circle-fill" style="color: #00bcd4;"></i> Reconnaissance</h1>
        <p class="lead text-muted">Server Mapping & Discovery</p>
    </div>

    <!-- Story Box -->
    <div class="story-box">
        <h4><i class="bi bi-binoculars"></i> The Mission</h4>
        <p class="story-narrator">
            "You can execute commands on the server. Now it's time for reconnaissance. Map out the file 
            system, discover interesting directories, and locate sensitive files. Good attackers always 
            gather intelligence before striking. Use directory listing commands to explore the server..."
        </p>
    </div>

    {% if found_secret %}
    <div class="success-banner mb-4">
        <h3><i class="bi bi-trophy"></i> Stage 2 Complete!</h3>
        <p class="mb-0">You've discovered the secret directory!</p>
        <a href="/attack_chain_3/stage3" class="btn btn-light mt-3">
            <i class="bi bi-arrow-right-circle"></i> Proceed to Stage 3: Data Exfiltration
        </a>
    </div>
    {% endif %}

    <div class="row">
        <!-- Command Execution -->
        <div class="col-md-8 mb-4">
            <div class="card border-danger h-100">
                <div class="card-header bg-danger text-white">
                    <strong><i class="bi bi-terminal"></i> Command Terminal</strong>
                    <span class="badge bg-dark float-end">Explore the server</span>
                </div>
                <div class="card-body">
                    <form method="get">
                        <div class="input-group mb-3">
                            <span class="input-group-text bg-dark text-success">$</span>
                            <input type="text" class="form-control font-monospace bg-dark text-success" 
                                   name="cmd" value="{{ cmd or '' }}">
                            <button type="submit" class="btn btn-danger">
                                <i class="bi bi-play-fill"></i> Execute
                            </button>
                        </div>
                    </form>
                    
                    {% if cmd_output %}
                    <div class="terminal-box">
                        <pre class="mb-0 text-success" style="max-height: 400px; overflow-y: auto;"><code>{{ cmd_output }}</code></pre>
                    </div>
                    {% endif %}
                    
                    <!-- Progressive Hints System -->
                    <div class="hint-revealer">
                        <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
                            <strong><i class="bi bi-puzzle"></i> Need Help?</strong>
                            <div>
                                <button class="btn btn-sm btn-outline-warning hint-btn" onclick="revealHint(1)">Hint 1</button>
                                <button class="btn btn-sm btn-outline-warning hint-btn" onclick="revealHint(2)">Hint 2</button>
                                <button class="btn btn-sm btn-outline-warning hint-btn" onclick="revealHint(3)">Hint 3</button>
                                <button class="btn btn-sm btn-outline-danger hint-btn" onclick="revealAnswer()">ðŸš¨ Reveal Answer</button>
                            </div>
                        </div>
                        <div id="hint-1" class="hint-level">
                            <i class="bi bi-lightbulb text-warning"></i> <strong>Hint 1:</strong> 
                            Use <code>dir</code> (Windows) or <code>ls -la</code> (Linux) to list directories.
                        </div>
                        <div id="hint-2" class="hint-level">
                            <i class="bi bi-lightbulb text-warning"></i> <strong>Hint 2:</strong> 
                            Add <code>/s</code> on Windows or <code>-R</code> on Linux for recursive listing. Look for unusual directory names.
                        </div>
                        <div id="hint-3" class="hint-level">
                            <i class="bi bi-lightbulb text-warning"></i> <strong>Hint 3:</strong> 
                            Try <code>dir /s /b *secret*</code> to search for directories containing "secret" in their name.
                        </div>
                        <div id="answer" class="answer-reveal">
                            <strong><i class="bi bi-key-fill text-danger"></i> Answer:</strong>
                            <div class="mt-2">
                                <code class="bg-dark p-2 d-block rounded">dir /s /b secret</code>
                                <small class="text-muted mt-2 d-block">This recursively lists all files in directories named "secret"!</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Useful Commands Reference -->
        <div class="col-md-4 mb-4">
            <div class="card border-info h-100">
                <div class="card-header bg-info text-dark">
                    <strong><i class="bi bi-book"></i> Recon Commands</strong>
                </div>
                <div class="card-body">
                    <h6><i class="bi bi-windows text-info"></i> Windows:</h6>
                    <ul class="small">
                        <li><code>dir</code> - List directory</li>
                        <li><code>dir /s /b</code> - Recursive list</li>
                        <li><code>type file.txt</code> - Read file</li>
                        <li><code>whoami</code> - Current user</li>
                        <li><code>hostname</code> - Server name</li>
                    </ul>
                    
                    <h6><i class="bi bi-ubuntu text-warning"></i> Linux:</h6>
                    <ul class="small mb-0">
                        <li><code>ls -la</code> - List with details</li>
                        <li><code>find / -name "*secret*"</code> - Find files</li>
                        <li><code>cat file.txt</code> - Read file</li>
                        <li><code>id</code> - Current user info</li>
                        <li><code>uname -a</code> - System info</li>
                    </ul>
                </div>
            </div>
            
            {% if discoveries %}
            <div class="card border-warning mt-3">
                <div class="card-header bg-warning text-dark">
                    <strong><i class="bi bi-star-fill"></i> Discoveries</strong>
                </div>
                <div class="card-body">
                    <ul class="mb-0 small">
                        {% for item in discoveries %}
                        <li class="text-success">{{ item }}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
function revealHint(num) {
    for (let i = 1; i <= num; i++) {
        document.getElementById('hint-' + i).classList.add('revealed');
    }
}

function revealAnswer() {
    for (let i = 1; i <= 3; i++) {
        document.getElementById('hint-' + i).classList.add('revealed');
    }
    document.getElementById('answer').classList.add('revealed');
}
</script>
</body>
</html>
